!function() {
    function a(a) {
        return "string" !== typeof a ? !1 : -1 !== a.search(/^[a-h][1-8]$/);
    }
    function b(a) {
        if ("string" !== typeof a) return !1;
        a = a.replace(/ .+$/, "");
        a = a.split("/");
        if (8 !== a.length) return !1;
        for (var b = 0; 8 > b; b++) if ("" === a[b] || 8 < a[b].length || -1 !== a[b].search(/[^kqrbnpKQRNBP1-8]/)) return !1;
        return !0;
    }
    function c(b) {
        if ("object" !== typeof b) return !1;
        for (var c in b) if (!0 === b.hasOwnProperty(c)) {
            var d;
            (d = !0 !== a(c)) || (d = b[c], d = "string" !== typeof d ? !1 : -1 !== d.search(/^[bw][KQRNBP]$/), 
            d = !0 !== d);
            if (d) return !1;
        }
        return !0;
    }
    function d(a) {
        if (!0 !== b(a)) return !1;
        a = a.replace(/ .+$/, "");
        a = a.split("/");
        for (var c = {}, d = 8, e = 0; 8 > e; e++) {
            for (var g = a[e].split(""), h = 0, i = 0; i < g.length; i++) if (-1 !== g[i].search(/[1-8]/)) var j = parseInt(g[i], 10), h = h + j; else {
                var j = c, k = f[h] + d, l;
                l = g[i];
                l = l.toLowerCase() === l ? "b" + l.toUpperCase() : "w" + l.toUpperCase();
                j[k] = l;
                h++;
            }
            d--;
        }
        return c;
    }
    function e(a) {
        if (!0 !== c(a)) return !1;
        for (var b = "", d = 8, e = 0; 8 > e; e++) {
            for (var g = 0; 8 > g; g++) {
                var h = f[g] + d;
                !0 === a.hasOwnProperty(h) ? (h = a[h].split(""), h = "w" === h[0] ? h[1].toUpperCase() : h[1].toLowerCase(), 
                b += h) : b += "1";
            }
            7 !== e && (b += "/");
            d--;
        }
        b = b.replace(/11111111/g, "8");
        b = b.replace(/1111111/g, "7");
        b = b.replace(/111111/g, "6");
        b = b.replace(/11111/g, "5");
        b = b.replace(/1111/g, "4");
        b = b.replace(/111/g, "3");
        return b = b.replace(/11/g, "2");
    }
    var f = "abcdefgh".split("");
    window.ChessBoard = window.ChessBoard || function(g, h) {
        function i() {
            return "xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g, function(a) {
                return (16 * Math.random() | 0).toString(16);
            });
        }
        function j(a) {
            return JSON.parse(JSON.stringify(a));
        }
        function k(a) {
            a = a.split(".");
            return {
                major: parseInt(a[0], 10),
                minor: parseInt(a[1], 10),
                patch: parseInt(a[2], 10)
            };
        }
        function l(a, b, c) {
            if (!0 === h.hasOwnProperty("showErrors") && !1 !== h.showErrors) {
                var d = "ChessBoard Error " + a + ": " + b;
                "console" === h.showErrors && "object" === typeof console && "function" === typeof console.log ? (console.log(d), 
                2 <= arguments.length && console.log(c)) : "alert" === h.showErrors ? (c && (d += "\n\n" + JSON.stringify(c)), 
                window.alert(d)) : "function" === typeof h.showErrors && h.showErrors(a, b, c);
            }
        }
        function m(a) {
            return "fast" === a || "slow" === a ? !0 : parseInt(a, 10) + "" !== a + "" ? !1 : 0 <= a;
        }
        function n() {
            for (var a = 0; a < f.length; a++) for (var b = 1; 8 >= b; b++) {
                var c = f[a] + b;
                mb[c] = c + "-" + i();
            }
            b = "KQRBNP".split("");
            for (a = 0; a < b.length; a++) {
                var c = "w" + b[a], d = "b" + b[a];
                lb[c] = c + "-" + i();
                lb[d] = d + "-" + i();
            }
        }
        function o() {
            var a = '<div class="' + X.chessboard + '">';
            !0 === h.sparePieces && (a += '<div class="' + X.sparePieces + " " + X.sparePiecesTop + '"></div>');
            a += '<div class="' + X.board + '"></div>';
            !0 === h.sparePieces && (a += '<div class="' + X.sparePieces + " " + X.sparePiecesBottom + '"></div>');
            return a + "</div>";
        }
        function p(a) {
            "black" !== a && (a = "white");
            var b = "", c = j(f), d = 8;
            "black" === a && (c.reverse(), d = 1);
            for (var e = "white", g = 0; 8 > g; g++) {
                for (var b = b + ('<div class="' + X.row + '">'), i = 0; 8 > i; i++) {
                    var k = c[i] + d, b = b + ('<div class="' + X.square + " " + X[e] + " square-" + k + '" style="width: ' + gb + "px; height: " + gb + 'px" id="' + mb[k] + '" data-square="' + k + '">');
                    if (!0 === h.showNotation) {
                        if ("white" === a && 1 === d || "black" === a && 8 === d) b += '<div class="' + X.notation + " " + X.alpha + '">' + c[i] + "</div>";
                        0 === i && (b += '<div class="' + X.notation + " " + X.numeric + '">' + d + "</div>");
                    }
                    b += "</div>";
                    e = "white" === e ? "black" : "white";
                }
                b += '<div class="' + X.clearfix + '"></div></div>';
                e = "white" === e ? "black" : "white";
                "white" === a ? d-- : d++;
            }
            return b;
        }
        function q(a) {
            if ("function" === typeof h.pieceTheme) return h.pieceTheme(a);
            if ("string" === typeof h.pieceTheme) return h.pieceTheme.replace(/{piece}/g, a);
            l(8272, "Unable to build image source for cfg.pieceTheme.");
            return "";
        }
        function r(a, b, c) {
            var d = '<img src="' + q(a) + '" ';
            c && "string" === typeof c && (d += 'id="' + c + '" ');
            d += 'alt="" class="' + X.piece + '" data-piece="' + a + '" style="width: ' + gb + "px;height: " + gb + "px;";
            !0 === b && (d += "display:none;");
            return d + '" />';
        }
        function s(a) {
            var b = "wK wQ wR wB wN wP".split(" ");
            "black" === a && (b = "bK bQ bR bB bN bP".split(" "));
            a = "";
            for (var c = 0; c < b.length; c++) a += r(b[c], !1, lb[b[c]]);
            return a;
        }
        function t(a, b, c, d) {
            a = $("#" + mb[a]);
            var e = a.offset(), f = $("#" + mb[b]);
            b = f.offset();
            var g = i();
            $("body").append(r(c, !0, g));
            var j = $("#" + g);
            j.css({
                display: "",
                position: "absolute",
                top: e.top,
                left: e.left
            });
            a.find("." + X.piece).remove();
            j.animate(b, {
                duration: h.moveSpeed,
                complete: function() {
                    f.append(r(c));
                    j.remove();
                    "function" === typeof d && d();
                }
            });
        }
        function u(a, b, c) {
            var d = $("#" + lb[a]).offset(), e = $("#" + mb[b]);
            b = e.offset();
            var f = i();
            $("body").append(r(a, !0, f));
            var g = $("#" + f);
            g.css({
                display: "",
                position: "absolute",
                left: d.left,
                top: d.top
            });
            g.animate(b, {
                duration: h.moveSpeed,
                complete: function() {
                    e.find("." + X.piece).remove();
                    e.append(r(a));
                    g.remove();
                    "function" === typeof c && c();
                }
            });
        }
        function v(a, b, c) {
            function d() {
                e++;
                if (e === a.length && (y(), !0 === h.hasOwnProperty("onMoveEnd") && "function" === typeof h.onMoveEnd)) h.onMoveEnd(j(b), j(c));
            }
            for (var e = 0, f = 0; f < a.length; f++) "clear" === a[f].type && $("#" + mb[a[f].square] + " ." + X.piece).fadeOut(h.trashSpeed, d), 
            "add" === a[f].type && !0 !== h.sparePieces && $("#" + mb[a[f].square]).append(r(a[f].piece, !0)).find("." + X.piece).fadeIn(h.appearSpeed, d), 
            "add" === a[f].type && !0 === h.sparePieces && u(a[f].piece, a[f].square, d), "move" === a[f].type && t(a[f].source, a[f].destination, a[f].piece, d);
        }
        function w(a, b) {
            a = a.split("");
            var c = f.indexOf(a[0]) + 1, d = parseInt(a[1], 10);
            b = b.split("");
            var e = f.indexOf(b[0]) + 1, g = parseInt(b[1], 10), c = Math.abs(c - e), d = Math.abs(d - g);
            return c >= d ? c : d;
        }
        function x(a) {
            for (var b = [], c = 0; 8 > c; c++) for (var d = 0; 8 > d; d++) {
                var e = f[c] + (d + 1);
                a !== e && b.push({
                    square: e,
                    distance: w(a, e)
                });
            }
            b.sort(function(a, b) {
                return a.distance - b.distance;
            });
            a = [];
            for (c = 0; c < b.length; c++) a.push(b[c].square);
            return a;
        }
        function y() {
            Z.find("." + X.piece).remove();
            for (var a in fb) !0 === fb.hasOwnProperty(a) && $("#" + mb[a]).append(r(fb[a]));
        }
        function z() {
            Z.html(p(eb));
            y();
            !0 === h.sparePieces && ("white" === eb ? (ab.html(s("black")), bb.html(s("white"))) : (ab.html(s("white")), 
            bb.html(s("black"))));
        }
        function A(a) {
            var b = j(fb), c = j(a), d = e(b), f = e(c);
            if (d !== f) {
                if (!0 === h.hasOwnProperty("onChange") && "function" === typeof h.onChange) h.onChange(b, c);
                fb = a;
            }
        }
        function B(a, b) {
            for (var c in nb) if (!0 === nb.hasOwnProperty(c)) {
                var d = nb[c];
                if (a >= d.left && a < d.left + gb && b >= d.top && b < d.top + gb) return c;
            }
            return "offboard";
        }
        function C() {
            Z.find("." + X.square).removeClass(X.highlight1 + " " + X.highlight2);
        }
        function D() {
            function a() {
                y();
                _.css("display", "none");
                if (!0 === h.hasOwnProperty("onSnapbackEnd") && "function" === typeof h.onSnapbackEnd) h.onSnapbackEnd(hb, jb, j(fb), eb);
            }
            if ("spare" === jb) E(); else {
                C();
                var b = $("#" + mb[jb]).offset();
                _.animate(b, {
                    duration: h.snapbackSpeed,
                    complete: a
                });
                kb = !1;
            }
        }
        function E() {
            C();
            var a = j(fb);
            delete a[jb];
            A(a);
            y();
            _.fadeOut(h.trashSpeed);
            kb = !1;
        }
        function F(a) {
            C();
            var b = j(fb);
            delete b[jb];
            b[a] = hb;
            A(b);
            b = $("#" + mb[a]).offset();
            _.animate(b, {
                duration: h.snapSpeed,
                complete: function() {
                    y();
                    _.css("display", "none");
                    if (!0 === h.hasOwnProperty("onSnapEnd") && "function" === typeof h.onSnapEnd) h.onSnapEnd(jb, a, hb);
                }
            });
            kb = !1;
        }
        function G(a, b, c, d) {
            if ("function" !== typeof h.onDragStart || !1 !== h.onDragStart(a, b, j(fb), eb)) {
                kb = !0;
                hb = b;
                jb = a;
                ib = "spare" === a ? "offboard" : a;
                nb = {};
                for (var e in mb) !0 === mb.hasOwnProperty(e) && (nb[e] = $("#" + mb[e]).offset());
                _.attr("src", q(b)).css({
                    display: "",
                    position: "absolute",
                    left: c - gb / 2,
                    top: d - gb / 2
                });
                "spare" !== a && $("#" + mb[a]).addClass(X.highlight1).find("." + X.piece).css("display", "none");
            }
        }
        function H(b, c) {
            _.css({
                left: b - gb / 2,
                top: c - gb / 2
            });
            var d = B(b, c);
            if (d !== ib) {
                !0 === a(ib) && $("#" + mb[ib]).removeClass(X.highlight2);
                !0 === a(d) && $("#" + mb[d]).addClass(X.highlight2);
                if ("function" === typeof h.onDragMove) h.onDragMove(d, ib, jb, hb, j(fb), eb);
                ib = d;
            }
        }
        function I(b) {
            var c = "drop";
            "offboard" === b && "snapback" === h.dropOffBoard && (c = "snapback");
            "offboard" === b && "trash" === h.dropOffBoard && (c = "trash");
            if (!0 === h.hasOwnProperty("onDrop") && "function" === typeof h.onDrop) {
                var d = j(fb);
                "spare" === jb && !0 === a(b) && (d[b] = hb);
                !0 === a(jb) && "offboard" === b && delete d[jb];
                !0 === a(jb) && !0 === a(b) && (delete d[jb], d[b] = hb);
                var e = j(fb), d = h.onDrop(jb, b, hb, d, e, eb);
                if ("snapback" === d || "trash" === d) c = d;
            }
            "snapback" === c ? D() : "trash" === c ? E() : "drop" === c && F(b);
        }
        function J(a) {
            a.preventDefault();
        }
        function K(b) {
            if (!0 === h.draggable) {
                var c = $(this).attr("data-square");
                !0 === a(c) && !0 === fb.hasOwnProperty(c) && G(c, fb[c], b.pageX, b.pageY);
            }
        }
        function L(b) {
            if (!0 === h.draggable) {
                var c = $(this).attr("data-square");
                !0 === a(c) && !0 === fb.hasOwnProperty(c) && (b = b.originalEvent, G(c, fb[c], b.changedTouches[0].pageX, b.changedTouches[0].pageY));
            }
        }
        function M(a) {
            if (!0 === h.sparePieces) {
                var b = $(this).attr("data-piece");
                G("spare", b, a.pageX, a.pageY);
            }
        }
        function N(a) {
            if (!0 === h.sparePieces) {
                var b = $(this).attr("data-piece");
                a = a.originalEvent;
                G("spare", b, a.changedTouches[0].pageX, a.changedTouches[0].pageY);
            }
        }
        function O(a) {
            !0 === kb && H(a.pageX, a.pageY);
        }
        function P(a) {
            !0 === kb && (a.preventDefault(), H(a.originalEvent.changedTouches[0].pageX, a.originalEvent.changedTouches[0].pageY));
        }
        function Q(a) {
            !0 === kb && (a = B(a.pageX, a.pageY), I(a));
        }
        function R(a) {
            !0 === kb && (a = B(a.originalEvent.changedTouches[0].pageX, a.originalEvent.changedTouches[0].pageY), 
            I(a));
        }
        function S(b) {
            if (!1 === kb && !0 === h.hasOwnProperty("onMouseoverSquare") && "function" === typeof h.onMouseoverSquare && (b = $(b.currentTarget).attr("data-square"), 
            !0 === a(b))) {
                var c = !1;
                !0 === fb.hasOwnProperty(b) && (c = fb[b]);
                h.onMouseoverSquare(b, c, j(fb), eb);
            }
        }
        function T(b) {
            if (!1 === kb && !0 === h.hasOwnProperty("onMouseoutSquare") && "function" === typeof h.onMouseoutSquare && (b = $(b.currentTarget).attr("data-square"), 
            !0 === a(b))) {
                var c = !1;
                !0 === fb.hasOwnProperty(b) && (c = fb[b]);
                h.onMouseoutSquare(b, c, j(fb), eb);
            }
        }
        function U() {
            $("body").on("mousedown mousemove", "." + X.piece, J);
            Z.on("mousedown", "." + X.square, K);
            Y.on("mousedown", "." + X.sparePieces + " ." + X.piece, M);
            Z.on("mouseenter", "." + X.square, S);
            Z.on("mouseleave", "." + X.square, T);
            !0 === (navigator && navigator.userAgent && -1 !== navigator.userAgent.search(/MSIE/)) ? (document.ondragstart = function() {
                return !1;
            }, $("body").on("mousemove", O), $("body").on("mouseup", Q)) : ($(window).on("mousemove", O), 
            $(window).on("mouseup", Q));
            !0 === "ontouchstart" in document.documentElement && (Z.on("touchstart", "." + X.square, L), 
            Y.on("touchstart", "." + X.sparePieces + " ." + X.piece, N), $(window).on("touchmove", P), 
            $(window).on("touchend", R));
        }
        function V() {
            Y.html(o());
            Z = Y.find("." + X.board);
            !0 === h.sparePieces && (ab = Y.find("." + X.sparePiecesTop), bb = Y.find("." + X.sparePiecesBottom));
            var a = i();
            $("body").append(r("wP", !0, a));
            _ = $("#" + a);
            db = parseInt(Z.css("borderLeftWidth"), 10);
            cb.resize();
        }
        h = h || {};
        var W = d("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"), X = {
            alpha: "alpha-d2270",
            black: "black-3c85d",
            board: "board-b72b1",
            chessboard: "chessboard-63f37",
            clearfix: "clearfix-7da63",
            highlight1: "highlight1-32417",
            highlight2: "highlight2-9c5d2",
            notation: "notation-322f9",
            numeric: "numeric-fc462",
            piece: "piece-417db",
            row: "row-5277c",
            sparePieces: "spare-pieces-7492f",
            sparePiecesBottom: "spare-pieces-bottom-ae20f",
            sparePiecesTop: "spare-pieces-top-4028b",
            square: "square-55d63",
            white: "white-1e1d7"
        }, Y, Z, _, ab, bb, cb = {}, db = 2, eb = "white", fb = {}, gb, hb, ib, jb, kb = !1, lb = {}, mb = {}, nb;
        cb.clear = function(a) {
            cb.position({}, a);
        };
        cb.destroy = function() {
            Y.html("");
            _.remove();
            Y.unbind();
        };
        cb.fen = function() {
            return cb.position("fen");
        };
        cb.flip = function() {
            cb.orientation("flip");
        };
        cb.move = function() {
            if (0 !== arguments.length) {
                for (var b = !0, c = {}, d = 0; d < arguments.length; d++) if (!1 === arguments[d]) b = !1; else {
                    var e;
                    e = arguments[d];
                    "string" !== typeof e ? e = !1 : (e = e.split("-"), e = 2 !== e.length ? !1 : !0 === a(e[0]) && !0 === a(e[1]));
                    !0 !== e ? l(2826, "Invalid move passed to the move method.", arguments[d]) : (e = arguments[d].split("-"), 
                    c[e[0]] = e[1]);
                }
                var d = fb, d = j(d), f;
                for (f in c) !0 === c.hasOwnProperty(f) && !0 === d.hasOwnProperty(f) && (e = d[f], 
                delete d[f], d[c[f]] = e);
                c = d;
                cb.position(c, b);
                return c;
            }
        };
        cb.orientation = function(a) {
            if (0 === arguments.length) return eb;
            "white" === a || "black" === a ? (eb = a, z()) : "flip" === a ? (eb = "white" === eb ? "black" : "white", 
            z()) : l(5482, "Invalid value passed to the orientation method.", a);
        };
        cb.position = function(a, f) {
            if (0 === arguments.length) return j(fb);
            if ("string" === typeof a && "fen" === a.toLowerCase()) return e(fb);
            !1 !== f && (f = !0);
            "string" === typeof a && "start" === a.toLowerCase() && (a = j(W));
            !0 === b(a) && (a = d(a));
            if (!0 !== c(a)) l(6482, "Invalid value passed to the position method.", a); else if (!0 === f) {
                var g = fb, h = a, g = j(g), h = j(h), i = [], k = {}, m;
                for (m in h) !0 === h.hasOwnProperty(m) && !0 === g.hasOwnProperty(m) && g[m] === h[m] && (delete g[m], 
                delete h[m]);
                for (m in h) if (!0 === h.hasOwnProperty(m)) {
                    var n;
                    a: {
                        n = g;
                        for (var o = h[m], p = x(m), q = 0; q < p.length; q++) {
                            var r = p[q];
                            if (!0 === n.hasOwnProperty(r) && n[r] === o) {
                                n = r;
                                break a;
                            }
                        }
                        n = !1;
                    }
                    !1 !== n && (i.push({
                        type: "move",
                        source: n,
                        destination: m,
                        piece: h[m]
                    }), delete g[n], delete h[m], k[m] = !0);
                }
                for (m in h) !0 === h.hasOwnProperty(m) && (i.push({
                    type: "add",
                    square: m,
                    piece: h[m]
                }), delete h[m]);
                for (m in g) !0 === g.hasOwnProperty(m) && !0 !== k.hasOwnProperty(m) && (i.push({
                    type: "clear",
                    square: m,
                    piece: g[m]
                }), delete g[m]);
                v(i, fb, a);
                A(a);
            } else A(a), y();
        };
        cb.resize = function() {
            var a = parseInt(Y.css("width"), 10);
            if (!a || 0 >= a) gb = 0; else {
                for (a -= 1; 0 !== a % 8 && 0 < a; ) a--;
                gb = a / 8;
            }
            Z.css("width", 8 * gb + "px");
            _.css({
                height: gb,
                width: gb
            });
            !0 === h.sparePieces && Y.find("." + X.sparePieces).css("paddingLeft", gb + db + "px");
            z();
        };
        cb.start = function(a) {
            cb.position("start", a);
        };
        var ob;
        if (ob = !0 === function() {
            if ("string" === typeof g) {
                if ("" === g) return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."), 
                !1;
                var a = document.getElementById(g);
                if (!a) return window.alert('ChessBoard Error 1002: Element with id "' + g + '" does not exist in the DOM.\n\nExiting...'), 
                !1;
                Y = $(a);
            } else if (Y = $(g), 1 !== Y.length) return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."), 
            !1;
            if (!window.JSON || "function" !== typeof JSON.stringify || "function" !== typeof JSON.parse) return window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."), 
            !1;
            if (a = typeof window.$) if (a = $.fn) if (a = $.fn.jquery) var a = $.fn.jquery, b = "1.7.0", a = k(a), b = k(b), a = !0 === 1e8 * a.major + 1e4 * a.minor + a.patch >= 1e8 * b.major + 1e4 * b.minor + b.patch;
            return a ? !0 : (window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.7.0 or higher on the page.\n\nExiting..."), 
            !1);
        }()) {
            if ("string" === typeof h || !0 === c(h)) h = {
                position: h
            };
            "black" !== h.orientation && (h.orientation = "white");
            eb = h.orientation;
            !1 !== h.showNotation && (h.showNotation = !0);
            !0 !== h.draggable && (h.draggable = !1);
            "trash" !== h.dropOffBoard && (h.dropOffBoard = "snapback");
            !0 !== h.sparePieces && (h.sparePieces = !1);
            !0 === h.sparePieces && (h.draggable = !0);
            if (!0 !== h.hasOwnProperty("pieceTheme") || "string" !== typeof h.pieceTheme && "function" !== typeof h.pieceTheme) h.pieceTheme = "{piece}.png";
            if (!0 !== h.hasOwnProperty("appearSpeed") || !0 !== m(h.appearSpeed)) h.appearSpeed = 200;
            if (!0 !== h.hasOwnProperty("moveSpeed") || !0 !== m(h.moveSpeed)) h.moveSpeed = 200;
            if (!0 !== h.hasOwnProperty("snapbackSpeed") || !0 !== m(h.snapbackSpeed)) h.snapbackSpeed = 50;
            if (!0 !== h.hasOwnProperty("snapSpeed") || !0 !== m(h.snapSpeed)) h.snapSpeed = 25;
            if (!0 !== h.hasOwnProperty("trashSpeed") || !0 !== m(h.trashSpeed)) h.trashSpeed = 100;
            !0 === h.hasOwnProperty("position") && ("start" === h.position ? fb = j(W) : !0 === b(h.position) ? fb = d(h.position) : !0 === c(h.position) ? fb = j(h.position) : l(7263, "Invalid value passed to config.position.", h.position));
            ob = !0;
        }
        ob && (n(), V(), U());
        return cb;
    };
    window.ChessBoard.fenToObj = d;
    window.ChessBoard.objToFen = e;
}();